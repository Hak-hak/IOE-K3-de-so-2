<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOE K3 2022-2023 SỐ 02 - Luyện thi tiếng Anh</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel (để biên dịch JSX ngay trên trình duyệt) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
      body { font-family: 'Nunito', sans-serif; }
      
      /* Animations */
      @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
      .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
      
      @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
      .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }
      
      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #f1f5f9; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "clsx": "https://aistudiocdn.com/clsx@^2.1.1",
    "tailwind-merge": "https://aistudiocdn.com/tailwind-merge@^3.4.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-800 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. ICONS (Inline SVG components to replace lucide-react dependency) ---
        const Icons = {
            Volume2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
            Play: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Pause: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
            GraduationCap: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>,
            Trophy: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
            CheckCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            XCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>,
            RefreshCw: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>,
            Eye: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            RotateCcw: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            CheckCircle2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
            Lightbulb: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
            HelpCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>,
            ArrowLeft: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            ArrowRight: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
            CheckSquare: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 11 3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>,
            Flag: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>,
            LayoutGrid: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            X: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 18 12"/></svg>
        };

        // --- 2. CONSTANTS & DATA ---
        const QuestionType = {
            MULTIPLE_CHOICE: 'MULTIPLE_CHOICE',
            FILL_IN_BLANK: 'FILL_IN_BLANK',
            REARRANGE: 'REARRANGE'
        };

        const GameState = {
            START: 'START',
            PLAYING: 'PLAYING',
            FINISHED: 'FINISHED'
        };

        const cleanUrl = (url) => {
            if (!url) return undefined;
            return url.trim()
                .replace(/\s+/g, '')
                .replace(/res\.ioe\.vnzedu/, 'res.ioe.vn/edu')
                .replace(/res\.ioe\.vii/, 'res.ioe.vn')
                .replace(/res\.ioe\.vm/, 'res.ioe.vn')
                .replace(/Audio\s*mp3/i, 'Audio.mp3')
                .replace(/ImageExam\s*(\d)/, 'ImageExam/$1')
                .replace(/Olympic\s*ExamData/, 'OlympicExamData')
                .replace(/EOlympic\s*ExamData/, 'EOlympic/ExamData')
                .replace(/'/g, '')
                .replace(/Audio-mp3/i, 'Audio.mp3');
        };

        const QUIZ_DATA = [
            { id: 1, type: QuestionType.FILL_IN_BLANK, questionText: "What’s y_ ur name?", correctAnswer: "o", explanation: "Your: Của bạn." },
            { id: 2, type: QuestionType.FILL_IN_BLANK, questionText: "Let’s go to the school _ _ _ _ _ _ _ .", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206306167591442_Audio.mp3"), correctAnswer: "library", explanation: "School library: Thư viện trường học." },
            { id: 3, type: QuestionType.FILL_IN_BLANK, questionText: "I draw a pictu_ _ in the room.", correctAnswer: "re", explanation: "Picture: Bức tranh." },
            { id: 4, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ at is your name? - My name is Hung.", correctAnswer: "Wh", explanation: "What: Cái gì/Gì." },
            { id: 5, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["your book,", "Open", "please!"], correctAnswer: "Open your book, please!", explanation: "Làm ơn mở sách ra." },
            { id: 6, type: QuestionType.MULTIPLE_CHOICE, questionText: "May I ___ the book?", options: ["open", "stand", "play", "sit"], correctAnswer: "open", explanation: "Open the book: Mở sách." },
            { id: 7, type: QuestionType.FILL_IN_BLANK, questionText: "That is a big tr...e.", options: ["a", "u", "e", "i"], correctAnswer: "e", explanation: "Tree: Cái cây." },
            { id: 8, type: QuestionType.MULTIPLE_CHOICE, questionText: "_______ fine, thanks.", options: ["I am", "I", "I’m am", "I I’m"], correctAnswer: "I am", explanation: "I am fine: Tôi khỏe." },
            { id: 9, type: QuestionType.MULTIPLE_CHOICE, questionText: "Odd one out:", options: ["fish", "cat", "dog", "book"], correctAnswer: "book", explanation: "'Book' là đồ vật, các từ còn lại là con vật." },
            { id: 10, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["school.", "we", "This is", "go to", "the way"], correctAnswer: "This is the way we go to school.", explanation: "Đây là lối chúng em tới trường." },
            { id: 11, type: QuestionType.FILL_IN_BLANK, questionText: "Sit _ _ wn , please!", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/2-dt-34.jpg"), correctAnswer: "do", explanation: "Sit down: Ngồi xuống." },
            { id: 12, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out:", options: ["she", "my", "he", "you"], correctAnswer: "my", explanation: "'My' là tính từ sở hữu, các từ còn lại là đại từ nhân xưng." },
            { id: 13, type: QuestionType.FILL_IN_BLANK, questionText: "How _ _ _ are you? – I’m seven years old.", correctAnswer: "old", explanation: "How old: Hỏi tuổi." },
            { id: 14, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["am fine", ", thanks.", "I", "you?", "And"], correctAnswer: "I am fine , thanks. And you?", explanation: "Tôi khỏe, cảm ơn. Còn bạn thì sao?" },
            { id: 15, type: QuestionType.MULTIPLE_CHOICE, questionText: "... are you? – I’m fine, thanks.", options: ["Hi", "Hello", "How", "How’s"], correctAnswer: "How", explanation: "How are you?: Bạn khỏe không?" },
            { id: 16, type: QuestionType.FILL_IN_BLANK, questionText: "CH_ SS", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/4-dt-45.jpg"), correctAnswer: "E", explanation: "CHESS: Cờ vua." },
            { id: 17, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["and", "My brother", "two dogs.", "has", "a cat"], correctAnswer: "My brother has a cat and two dogs.", explanation: "Anh tôi có một con mèo và hai con chó." },
            { id: 18, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["A", "in the classroom.", "is", "black board"], correctAnswer: "A black board is in the classroom.", explanation: "Có một cái bảng đen trong lớp học." },
            { id: 19, type: QuestionType.FILL_IN_BLANK, questionText: "These cats are _ _ _ _ _ .", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207308239844588_566X320.jpg"), correctAnswer: "black", explanation: "Màu đen (Black)." },
            { id: 20, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["new", "my", "teacher.", "is", "Miss Lien"], correctAnswer: "Miss Lien is my new teacher.", explanation: "Cô Liên là giáo viên mới của tôi." },
            { id: 21, type: QuestionType.FILL_IN_BLANK, questionText: "A: _ _ _ _ ’s it? - B: It’s my notebook.", correctAnswer: "What", explanation: "What's it?: Nó là cái gì?" },
            { id: 22, type: QuestionType.FILL_IN_BLANK, questionText: "Point _ _ the teacher.", correctAnswer: "to", explanation: "Point to: Chỉ vào." },
            { id: 23, type: QuestionType.MULTIPLE_CHOICE, questionText: "Is your school new? - No. It's _____.", options: ["new", "old", "not", "is"], correctAnswer: "old", explanation: "Trái nghĩa với New (mới) là Old (cũ)." },
            { id: 24, type: QuestionType.MULTIPLE_CHOICE, questionText: "… that woman your new teacher?", options: ["Is", "Has", "Who’s", "Does"], correctAnswer: "Is", explanation: "Is that...: Đó có phải là..." },
            { id: 25, type: QuestionType.FILL_IN_BLANK, questionText: "Stand u_ , please.", correctAnswer: "p", explanation: "Stand up: Đứng dậy." },
            { id: 26, type: QuestionType.MULTIPLE_CHOICE, questionText: "Is your classroom big? - …, it isn't. It’s small.", options: ["Yes", "Yes, it isn’t", "No, it is", "No"], correctAnswer: "No", explanation: "Câu trả lời phủ định ngắn gọn: No." },
            { id: 27, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["your", "to", "friend.", "Listen"], correctAnswer: "Listen to your friend.", explanation: "Lắng nghe bạn của bạn." },
            { id: 28, type: QuestionType.MULTIPLE_CHOICE, questionText: "I’m ... , thank you. And you?", options: ["nice", "bye", "fine", "hi"], correctAnswer: "fine", explanation: "I'm fine: Tôi khỏe." },
            { id: 29, type: QuestionType.MULTIPLE_CHOICE, questionText: "… ? – It’s black.", options: ["What colour is it", "What is this", "How are you", "How many"], correctAnswer: "What colour is it", explanation: "Hỏi màu sắc: What colour is it?" },
            { id: 30, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Simon.", "Come", "over", "here,"], correctAnswer: "Come over here, Simon.", explanation: "Lại đây nào Simon." },
            { id: 31, type: QuestionType.MULTIPLE_CHOICE, questionText: "Is this your ruler? - No, ____ isn't", options: ["it", "that", "its", "it's"], correctAnswer: "it", explanation: "No, it isn't." },
            { id: 32, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["the pink", "pen,", "please.", "Give", "me"], correctAnswer: "Give me the pink pen, please.", explanation: "Làm ơn đưa cho tôi cái bút màu hồng." },
            { id: 33, type: QuestionType.MULTIPLE_CHOICE, questionText: "A: Who’s Tracy? - B: The girl is in the yellow shirt.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/2/636505021981546006_566X320.jpg"), options: ["1", "2", "3", "4"], correctAnswer: "4", explanation: "Quan sát tranh: Cô gái mặc áo vàng là số 4." },
            { id: 34, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Don't", "girls!", "in class,", "talk"], correctAnswer: "Don't talk in class, girls!", explanation: "Đừng nói chuyện trong lớp, các cô gái!" },
            { id: 35, type: QuestionType.FILL_IN_BLANK, questionText: "Is it _ ruler? – No, it isn’t.", correctAnswer: "a", explanation: "A ruler: Một cái thước." },
            { id: 36, type: QuestionType.MULTIPLE_CHOICE, questionText: "Jack ___ in the playground.", options: ["are", "am", "is", "be"], correctAnswer: "is", explanation: "Jack (số ít) -> is." },
            { id: 37, type: QuestionType.MULTIPLE_CHOICE, questionText: "I go to school ___ my classmates.", options: ["in", "and", "but", "with"], correctAnswer: "with", explanation: "With: Cùng với." },
            { id: 38, type: QuestionType.FILL_IN_BLANK, questionText: "W_ _ t is this? – This is a marker.", correctAnswer: "ha", explanation: "What: Cái gì." },
            { id: 39, type: QuestionType.MULTIPLE_CHOICE, questionText: "May I go out? - ... .", options: ["Hello", "Nice to meet you", "Fine, thanks", "Sure"], correctAnswer: "Sure", explanation: "Sure: Chắc chắn rồi (cho phép)." },
            { id: 40, type: QuestionType.FILL_IN_BLANK, questionText: "That’s my fathe_ .", correctAnswer: "r", explanation: "Father: Bố." },
            { id: 41, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["that,", "Who's", "Peter?"], correctAnswer: "Who's that, Peter?", explanation: "Đó là ai vậy Peter?" },
            { id: 42, type: QuestionType.MULTIPLE_CHOICE, questionText: "I go to school library to ... books.", options: ["read’s", "reads", "read", "read to"], correctAnswer: "read", explanation: "To read: Để đọc." },
            { id: 43, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Are", "sick", "you", "today?"], correctAnswer: "Are you sick today?", explanation: "Hôm nay bạn bị ốm à?" },
            { id: 44, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["books", "How", "there?", "many", "are"], correctAnswer: "How many books are there?", explanation: "Có bao nhiêu quyển sách?" },
            { id: 45, type: QuestionType.MULTIPLE_CHOICE, questionText: "Hi, I’m Collin. Nice to meet ....", options: ["me", "they", "he", "you"], correctAnswer: "you", explanation: "Nice to meet you." },
            { id: 46, type: QuestionType.MULTIPLE_CHOICE, questionText: "... this a pencil?", options: ["Are", "You", "Is", "My"], correctAnswer: "Is", explanation: "Is this...?" },
            { id: 47, type: QuestionType.MULTIPLE_CHOICE, questionText: "I’m standing in a ... .", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206312811331111_Audio.mp3"), options: ["living room", "classroom", "room", "bedroom"], correctAnswer: "classroom", explanation: "Nghe audio: Lớp học." },
            { id: 48, type: QuestionType.FILL_IN_BLANK, questionText: "I like basketba_ _ .", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/3-dt-36.mp3"), correctAnswer: "ll", explanation: "Basketball: Bóng rổ." },
            { id: 49, type: QuestionType.MULTIPLE_CHOICE, questionText: "The school _______ is large.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/3-tn-27.mp3"), options: ["gym", "school", "room", "library"], correctAnswer: "gym", explanation: "Nghe audio: Phòng tập thể dục." },
            { id: 50, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["the teacher", "Write", "what", "says."], correctAnswer: "Write what the teacher says.", explanation: "Viết những gì giáo viên nói." },
            { id: 51, type: QuestionType.FILL_IN_BLANK, questionText: "Unscramble this word: ’’YBEDOGO’’ -> ’’GOOD_ _ _ ’’.", correctAnswer: "BYE", explanation: "GOODBYE: Tạm biệt." },
            { id: 52, type: QuestionType.MULTIPLE_CHOICE, questionText: "A: … that boy your friend? - B: Yes, ….", options: ["Are – they are", "Are – they aren’t", "Is – he isn’t", "Is – he is"], correctAnswer: "Is – he is", explanation: "That boy (số ít) -> Is. Yes, he is." },
            { id: 53, type: QuestionType.FILL_IN_BLANK, questionText: "My school _ _ new.", correctAnswer: "is", explanation: "My school (số ít) -> is." },
            { id: 54, type: QuestionType.MULTIPLE_CHOICE, questionText: "Odd one out:", options: ["fish", "cat", "dog", "book"], correctAnswer: "book", explanation: "'Book' là đồ vật." },
            { id: 55, type: QuestionType.FILL_IN_BLANK, questionText: "It’s a _ _ _ blue green ball.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/11/30/636161053165241455_Audio.mp3"), correctAnswer: "big", explanation: "Nghe audio: To lớn (big)." },
            { id: 56, type: QuestionType.MULTIPLE_CHOICE, questionText: "Lan and Hoa ___ in class 3C.", options: ["is", "am", "are", "on"], correctAnswer: "are", explanation: "Lan and Hoa (số nhiều) -> are." },
            { id: 57, type: QuestionType.FILL_IN_BLANK, questionText: "That is a blue s_ _ _ .", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208321994581633_566X320.jpg"), correctAnswer: "hip", explanation: "Ship: Tàu thủy." },
            { id: 58, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Let’s", "make", "a", "circle."], correctAnswer: "Let’s make a circle.", explanation: "Hãy tạo thành một vòng tròn." },
            { id: 59, type: QuestionType.FILL_IN_BLANK, questionText: "Put your books on the tabl_ .", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi%20Th%E1%BB%AD/Thi_trai_nghiem_2021/Lop3/images1/dt.jpg"), correctAnswer: "e", explanation: "Table: Cái bàn." },
            { id: 60, type: QuestionType.FILL_IN_BLANK, questionText: "My brother likes playing _ _ _ _ _ _ _ _ games.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207295518636244_566X320.jpg"), correctAnswer: "computer", explanation: "Computer games: Trò chơi điện tử." },
            { id: 61, type: QuestionType.MULTIPLE_CHOICE, questionText: "Goodbye. ...", options: ["Nice to meet you", "See you later", "Good morning", "Good evening"], correctAnswer: "See you later", explanation: "Chào tạm biệt -> Hẹn gặp lại sau." },
            { id: 62, type: QuestionType.FILL_IN_BLANK, questionText: "Our _ _ _ _ _ _ _ _ is not big.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208311247935975_566X320.jpg"), correctAnswer: "bathroom", explanation: "Bathroom: Phòng tắm (dựa vào hình ảnh nếu có, hoặc từ vựng phổ biến)." },
            { id: 63, type: QuestionType.MULTIPLE_CHOICE, questionText: "TA_LE", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/1-tn-40.jpg"), options: ["P", "B", "C", "G"], correctAnswer: "B", explanation: "TABLE: Cái bàn." },
            { id: 64, type: QuestionType.MULTIPLE_CHOICE, questionText: "Gale ______ books in the school library.", options: ["listens", "speaks", "says", "reads"], correctAnswer: "reads", explanation: "Reads books: Đọc sách." },
            { id: 65, type: QuestionType.MULTIPLE_CHOICE, questionText: "____ are his pets.", options: ["These", "This", "That", "It"], correctAnswer: "These", explanation: "Pets (số nhiều) -> These." },
            { id: 66, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["is", "name?", "your", "What", "mother's"], correctAnswer: "What is your mother's name?", explanation: "Tên mẹ bạn là gì?" },
            { id: 67, type: QuestionType.FILL_IN_BLANK, questionText: "Is this _ _ eraser?", correctAnswer: "an", explanation: "An eraser." },
            { id: 68, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["my", "friends.", "are", "These"], correctAnswer: "These are my friends.", explanation: "Đây là những người bạn của tôi." },
            { id: 69, type: QuestionType.MULTIPLE_CHOICE, questionText: "Put the books … the table.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/4/636506592106747089_Audio.mp3"), options: ["under", "on", "next to", "behind"], correctAnswer: "on", explanation: "Nghe audio: Ở trên (on)." },
            { id: 70, type: QuestionType.MULTIPLE_CHOICE, questionText: "This is ... school bag.", options: ["he’s", "my’s", "me", "my"], correctAnswer: "my", explanation: "My (tính từ sở hữu)." },
            { id: 71, type: QuestionType.MULTIPLE_CHOICE, questionText: "The ball is ___ the box.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/4-tn-45.jpg"), options: ["in", "on", "at", "of"], correctAnswer: "in", explanation: "Nhìn tranh: Ở trong (in)." },
            { id: 72, type: QuestionType.MULTIPLE_CHOICE, questionText: "Listen and tick:", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206308991508402_Audio.mp3"), options: ["This is my T-shirt.", "This is my shirt.", "This is my skirt.", "This is my jeans."], correctAnswer: "This is my T-shirt.", explanation: "Nghe audio." },
            { id: 73, type: QuestionType.MULTIPLE_CHOICE, questionText: "There is a picture … the wall.", options: ["in", "at", "on", "of"], correctAnswer: "on", explanation: "On the wall: Trên tường." },
            { id: 74, type: QuestionType.MULTIPLE_CHOICE, questionText: "Is this a pencil box? – ..., it is.", options: ["No", "Not", "Yes", "No’s"], correctAnswer: "Yes", explanation: "Yes, it is." },
            { id: 75, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out", options: ["Green", "Yellow", "Apple", "Blue"], correctAnswer: "Apple", explanation: "'Apple' là trái cây, còn lại là màu sắc." },
            { id: 76, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["like", "My", "doesn’t", "brother", "cats."], correctAnswer: "My brother doesn’t like cats.", explanation: "Anh trai tôi không thích mèo." },
            { id: 77, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["school", "large?", "Is", "your"], correctAnswer: "Is your school large?", explanation: "Trường của bạn có rộng không?" },
            { id: 78, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the letter(s) to make a correct word: blac__", options: ["c", "t", "k", "h"], correctAnswer: "k", explanation: "BLACK: Màu đen." },
            { id: 79, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ _ do you spell your name, Sam? - It’s S-A-M.", correctAnswer: "How", explanation: "How do you spell...?" },
            { id: 80, type: QuestionType.FILL_IN_BLANK, questionText: "Listen and ti_ _ .", correctAnswer: "ck", explanation: "Tick: Đánh dấu." },
            { id: 81, type: QuestionType.FILL_IN_BLANK, questionText: "Let’s ma_ _ a line, students.", correctAnswer: "ke", explanation: "Make a line: Xếp hàng." },
            { id: 82, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["eight", "I", "am", "years old."], correctAnswer: "I am eight years old.", explanation: "Tôi 8 tuổi." },
            { id: 83, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["me.", "after", "repeat", "Please"], correctAnswer: "Please repeat after me.", explanation: "Làm ơn nhắc lại theo tôi." },
            { id: 84, type: QuestionType.FILL_IN_BLANK, questionText: "Bye. S_ _ you later.", correctAnswer: "ee", explanation: "See you later." },
            { id: 85, type: QuestionType.MULTIPLE_CHOICE, questionText: "My classroom is … .", options: ["name", "news", "new", "names"], correctAnswer: "new", explanation: "New (tính từ): Mới." },
            { id: 86, type: QuestionType.FILL_IN_BLANK, questionText: "Nice _ _ see you.", correctAnswer: "to", explanation: "Nice to see you." },
            { id: 87, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Put", "your", "down.", "hand"], correctAnswer: "Put your hand down.", explanation: "Hạ tay xuống." },
            { id: 88, type: QuestionType.MULTIPLE_CHOICE, questionText: "There are ... boats on the sea.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206364939134668_Audio.mp3"), options: ["twenty", "three", "two", "twelve"], correctAnswer: "three", explanation: "Nghe audio." },
            { id: 89, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["That", "green", "a", "is", "chair."], correctAnswer: "That is a green chair.", explanation: "Đó là một cái ghế màu xanh lá." },
            { id: 90, type: QuestionType.MULTIPLE_CHOICE, questionText: "What AREN’T the students doing?", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/2/636504878931926679_Audio.mp3"), options: ["Running", "Jumping", "Laughing", "Studying"], correctAnswer: "Studying", explanation: "Nghe audio: Họ đang chơi, không phải đang học." },
            { id: 91, type: QuestionType.FILL_IN_BLANK, questionText: "I’m fine, th_ _ k you.", correctAnswer: "an", explanation: "Thank you." },
            { id: 92, type: QuestionType.FILL_IN_BLANK, questionText: "There are two books o_ the table.", correctAnswer: "n", explanation: "On the table: Trên bàn." },
            { id: 93, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["on", "are there", "erasers", "How many", "the table?"], correctAnswer: "How many erasers are there on the table?", explanation: "Có bao nhiêu cục tẩy trên bàn?" },
            { id: 94, type: QuestionType.MULTIPLE_CHOICE, questionText: "My father is a doctor.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206377131960084_Audio.mp3"), options: ["My father is a teacher.", "My mother is a teacher", "My father is a doctor.", "My brother is a teacher."], correctAnswer: "My father is a doctor.", explanation: "Nghe audio." },
            { id: 95, type: QuestionType.MULTIPLE_CHOICE, questionText: "She wears a big ___ hat.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/4-tn-60.mp3"), options: ["black", "blue", "green", "yellow"], correctAnswer: "blue", explanation: "Nghe audio: Mũ xanh (blue)." },
            { id: 96, type: QuestionType.MULTIPLE_CHOICE, questionText: "This isn’t ... bag.", options: ["he", "his", "this", "he’s"], correctAnswer: "his", explanation: "His bag: Cặp của cậu ấy." },
            { id: 97, type: QuestionType.MULTIPLE_CHOICE, questionText: "I’m fine, thank you. ... ?", options: ["You", "And you", "Are you", "Bye"], correctAnswer: "And you", explanation: "Hỏi ngược lại: Còn bạn thì sao?" },
            { id: 98, type: QuestionType.MULTIPLE_CHOICE, questionText: "Look! That flower is ....", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2015/12/3/635847534640208109_566X320.jpg"), options: ["pink", "blue", "green", "black"], correctAnswer: "blue", explanation: "Nhìn tranh: Hoa màu xanh (blue)." },
            { id: 99, type: QuestionType.FILL_IN_BLANK, questionText: "How _ _ you spell your name?", correctAnswer: "do", explanation: "How do you spell...?" },
            { id: 100, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Raise", "your", "hands,", "please"], correctAnswer: "Raise your hands, please", explanation: "Làm ơn giơ tay lên." },
            { id: 101, type: QuestionType.MULTIPLE_CHOICE, questionText: "There are … sweets.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/11/30/636161037811773395_Audio.mp3"), options: ["three", "two", "four", "no"], correctAnswer: "two", explanation: "Nghe audio: 2 cái kẹo." },
            { id: 102, type: QuestionType.FILL_IN_BLANK, questionText: "Point and s_ y.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/4-dt-38.mp3"), correctAnswer: "a", explanation: "Say: Nói." },
            { id: 103, type: QuestionType.MULTIPLE_CHOICE, questionText: "... your name?", options: ["What", "What’s", "How’s", "Why’s"], correctAnswer: "What’s", explanation: "What's your name?" },
            { id: 104, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Hi, Mary.", "Nice to meet you."], correctAnswer: "Hi, Mary. Nice to meet you.", explanation: "Chào Mary. Rất vui được gặp bạn." },
            { id: 105, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out:", options: ["you", "I", "she", "my"], correctAnswer: "my", explanation: "'My' là tính từ sở hữu, còn lại là đại từ nhân xưng." },
            { id: 106, type: QuestionType.FILL_IN_BLANK, questionText: "I’m fine, th_ _ _ k you.", correctAnswer: "an", explanation: "Thank you." },
            { id: 107, type: QuestionType.MULTIPLE_CHOICE, questionText: "I ... Maths and Arts on Monday.", options: ["play", "say", "study", "look"], correctAnswer: "study", explanation: "Study: Học." },
            { id: 108, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["My rubber is small", "and my ruler is short."], correctAnswer: "My rubber is small and my ruler is short.", explanation: "Cục tẩy của tôi nhỏ và thước kẻ của tôi ngắn." },
            { id: 109, type: QuestionType.MULTIPLE_CHOICE, questionText: "I’m fine, thank ... .", options: ["yous", "you’s", "you’re", "you"], correctAnswer: "you", explanation: "Thank you." },
            { id: 110, type: QuestionType.FILL_IN_BLANK, questionText: "Sit do_ n, please.", correctAnswer: "w", explanation: "Sit down." },
            { id: 111, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Jenny is my friend."], correctAnswer: "Jenny is my friend.", explanation: "Jenny là bạn của tôi." },
            { id: 112, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["May I borrow your notebook?"], correctAnswer: "May I borrow your notebook?", explanation: "Tôi có thể mượn vở của bạn không?" },
            { id: 113, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Where are your books?"], correctAnswer: "Where are your books?", explanation: "Sách của bạn ở đâu?" },
            { id: 114, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["This is a purple bag."], correctAnswer: "This is a purple bag.", explanation: "Đây là một cái cặp màu tím." },
            { id: 115, type: QuestionType.MULTIPLE_CHOICE, questionText: "Where are ... from?", options: ["and", "my", "you", "she"], correctAnswer: "you", explanation: "Where are you from?" },
            { id: 116, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["How are you today, Mai and Phong?"], correctAnswer: "How are you today, Mai and Phong?", explanation: "Hôm nay các bạn thế nào, Mai và Phong?" },
            { id: 117, type: QuestionType.FILL_IN_BLANK, questionText: "Bye. _ _ _ you later.", correctAnswer: "see", explanation: "See you later." },
            { id: 118, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Please", "repeat", "after", "me."], correctAnswer: "Please repeat after me.", explanation: "Làm ơn nhắc lại theo tôi." },
            { id: 119, type: QuestionType.MULTIPLE_CHOICE, questionText: "A: What colour is this? - B: It’s ... .", options: ["book", "a green", "green", "pencil"], correctAnswer: "green", explanation: "Trả lời màu sắc: It's green." },
            { id: 120, type: QuestionType.MULTIPLE_CHOICE, questionText: "Open ... book, please.", options: ["you", "your", "you’s", "your’s"], correctAnswer: "your", explanation: "Your book." },
            { id: 121, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ this a ruler? – Yes, it is.", correctAnswer: "Is", explanation: "Is this...?" },
            { id: 122, type: QuestionType.FILL_IN_BLANK, questionText: "Listen _ _ me, please.", correctAnswer: "to", explanation: "Listen to me." },
            { id: 123, type: QuestionType.FILL_IN_BLANK, questionText: "That is my ho_ _ e.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207345145450116_566X320.jpg"), correctAnswer: "us", explanation: "House: Ngôi nhà." },
            { id: 124, type: QuestionType.MULTIPLE_CHOICE, questionText: "Nam's pencils are_____ .", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/2-tn-23.mp3"), options: ["black", "blue", "green", "red"], correctAnswer: "green", explanation: "Nghe audio: Màu xanh lá." },
            { id: 125, type: QuestionType.MULTIPLE_CHOICE, questionText: "Where is the ...?", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206313406004155_Audio.mp3"), options: ["bus", "class", "lab", "tab"], correctAnswer: "lab", explanation: "Nghe audio: Phòng thí nghiệm (lab)." },
            { id: 126, type: QuestionType.FILL_IN_BLANK, questionText: "E_ GHT", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/2-dt-41.jpg"), correctAnswer: "I", explanation: "EIGHT: Số 8." },
            { id: 127, type: QuestionType.MULTIPLE_CHOICE, questionText: "How do you … your name? – That’s A-N-N-E.", options: ["spell", "read", "call", "say"], correctAnswer: "spell", explanation: "Spell: Đánh vần." },
            { id: 128, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Raise", "your", "hand."], correctAnswer: "Raise your hand.", explanation: "Giơ tay lên." },
            { id: 129, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out", options: ["Ruler", "Pen", "Book", "Library"], correctAnswer: "Library", explanation: "'Library' là địa điểm, còn lại là dụng cụ học tập." },
            { id: 130, type: QuestionType.FILL_IN_BLANK, questionText: "LIS_ EN", correctAnswer: "T", explanation: "LISTEN: Nghe." },
            { id: 131, type: QuestionType.FILL_IN_BLANK, questionText: "Nam’s pencil is _ _ _ _ but mine is short.", correctAnswer: "long", explanation: "Long: Dài (trái nghĩa với short)." },
            { id: 132, type: QuestionType.FILL_IN_BLANK, questionText: "Gi_ e me the book, please.", correctAnswer: "v", explanation: "Give: Đưa." },
            { id: 133, type: QuestionType.FILL_IN_BLANK, questionText: "My n_ me is Hieu.", correctAnswer: "a", explanation: "Name: Tên." },
            { id: 134, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ _ _ the bag, please.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207366284327721_566X320.jpg"), correctAnswer: "Open", explanation: "Open the bag: Mở cặp." },
            { id: 135, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["I don't", "go to", "school", "today."], correctAnswer: "I don't go to school today.", explanation: "Hôm nay tôi không đi học." },
            { id: 136, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Listen to", "the", "teacher."], correctAnswer: "Listen to the teacher.", explanation: "Lắng nghe giáo viên." },
            { id: 137, type: QuestionType.MULTIPLE_CHOICE, questionText: "This isn’t ... ruler. It’s my ruler.", options: ["he’s", "his", "me’s", "you’s"], correctAnswer: "his", explanation: "His ruler: Thước của cậu ấy." },
            { id: 138, type: QuestionType.FILL_IN_BLANK, questionText: "Mary is at sch_ _ l.", correctAnswer: "oo", explanation: "School: Trường học." },
            { id: 139, type: QuestionType.FILL_IN_BLANK, questionText: "David and Tony p_ _ _ football after school.", correctAnswer: "lay", explanation: "Play football: Chơi bóng đá." },
            { id: 140, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["My", "shoes", "are", "new", "pink."], correctAnswer: "My new shoes are pink.", explanation: "Đôi giày mới của tôi màu hồng." },
            { id: 141, type: QuestionType.FILL_IN_BLANK, questionText: "Gi_ e me a pen, please.", correctAnswer: "v", explanation: "Give: Đưa." },
            { id: 142, type: QuestionType.FILL_IN_BLANK, questionText: "St_ _ d up, please.", correctAnswer: "an", explanation: "Stand up: Đứng dậy." },
            { id: 143, type: QuestionType.FILL_IN_BLANK, questionText: "Is th_ _ _ any water in the fridge, mom?", correctAnswer: "ere", explanation: "Is there...?" },
            { id: 144, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ _ many students are there in your classroom?", correctAnswer: "How", explanation: "How many." },
            { id: 145, type: QuestionType.MULTIPLE_CHOICE, questionText: "…, students. See you tomorrow.", options: ["Good morning", "Good night", "Goodbye", "Nice to meet you"], correctAnswer: "Goodbye", explanation: "See you tomorrow -> Goodbye." },
            { id: 146, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Don't", "ride", "your", "bike", "too fast."], correctAnswer: "Don't ride your bike too fast.", explanation: "Đừng đạp xe quá nhanh." },
            { id: 147, type: QuestionType.FILL_IN_BLANK, questionText: "She is my tea_ _ er.", correctAnswer: "ch", explanation: "Teacher: Giáo viên." },
            { id: 148, type: QuestionType.FILL_IN_BLANK, questionText: "M_ THER", correctAnswer: "O", explanation: "MOTHER: Mẹ." },
            { id: 149, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["How many", "books", "are there", "in", "your school bag?"], correctAnswer: "How many books are there in your school bag?", explanation: "Có bao nhiêu quyển sách trong cặp của bạn?" },
            { id: 150, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Put", "your pencil", "down."], correctAnswer: "Put your pencil down.", explanation: "Đặt bút xuống." },
            { id: 151, type: QuestionType.FILL_IN_BLANK, questionText: "Does she have bl_ _ _ _ hair?", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/16/636174959719066879_566X320.jpg"), correctAnswer: "onde", explanation: "Blonde hair: Tóc vàng." },
            { id: 152, type: QuestionType.FILL_IN_BLANK, questionText: "Pl_ _ _ ed to meet you, Linda.", correctAnswer: "eas", explanation: "Pleased to meet you." },
            { id: 153, type: QuestionType.MULTIPLE_CHOICE, questionText: "My school .... is small.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/2/636505008466109219_566X320.jpg"), options: ["playground", "library", "classroom", "gym"], correctAnswer: "playground", explanation: "Nhìn tranh: Sân chơi (playground)." },
            { id: 154, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ _ _ _ are my crayons.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/2/636504891760936521_Audio.mp3"), correctAnswer: "Those", explanation: "Nghe audio: Kia là (Those)." },
            { id: 155, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Does", "she like", "volleyball", "or", "basketball?"], correctAnswer: "Does she like volleyball or basketball?", explanation: "Cô ấy thích bóng chuyền hay bóng rổ?" },
            { id: 156, type: QuestionType.MULTIPLE_CHOICE, questionText: "This is ... cat.", options: ["he", "she", "my", "you"], correctAnswer: "my", explanation: "My cat: Mèo của tôi." },
            { id: 157, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out:", options: ["eraser", "ruler", "name", "pen"], correctAnswer: "name", explanation: "'Name' là danh từ trừu tượng, còn lại là đồ vật." },
            { id: 158, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Would", "you", "like", "an", "ice cream?"], correctAnswer: "Would you like an ice cream?", explanation: "Bạn có muốn ăn kem không?" },
            { id: 159, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ _ , he is.", correctAnswer: "Yes", explanation: "Yes, he is." },
            { id: 160, type: QuestionType.FILL_IN_BLANK, questionText: "My brother likes to play computer g_ _ _ _ .", correctAnswer: "ames", explanation: "Games: Trò chơi." },
            { id: 161, type: QuestionType.MULTIPLE_CHOICE, questionText: "Two maps __ on the wall.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/4-tn-56.jpg"), options: ["are", "is", "re", "am"], correctAnswer: "are", explanation: "Two maps (số nhiều) -> are." },
            { id: 162, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out:", options: ["how", "hello", "hi", "good morning"], correctAnswer: "how", explanation: "'How' là từ để hỏi, còn lại là lời chào." },
            { id: 163, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out:", options: ["book", "pencil", "rubber", "library"], correctAnswer: "library", explanation: "'Library' là địa điểm, còn lại là đồ dùng." },
            { id: 164, type: QuestionType.FILL_IN_BLANK, questionText: "This is my _ _ _ .", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/11/30/636161052058989367_Audio.mp3"), correctAnswer: "hat", explanation: "Nghe audio (hoặc đoán từ): Hat (mũ)." },
            { id: 165, type: QuestionType.FILL_IN_BLANK, questionText: "W_ _ _ are these? – These are pencil cases.", correctAnswer: "hat", explanation: "What are these?" },
            { id: 166, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out:", options: ["young", "white", "pink", "gray"], correctAnswer: "young", explanation: "'Young' là tính từ chỉ tuổi/tính chất, còn lại là màu sắc." },
            { id: 167, type: QuestionType.FILL_IN_BLANK, questionText: "Come here and _ _ _ _ an English song now.", correctAnswer: "sing", explanation: "Sing a song: Hát." },
            { id: 168, type: QuestionType.FILL_IN_BLANK, questionText: "Don't talk _ _ class!", correctAnswer: "in", explanation: "In class: Trong lớp." },
            { id: 169, type: QuestionType.FILL_IN_BLANK, questionText: "Fine, th_ nks.", correctAnswer: "a", explanation: "Thanks." },
            { id: 170, type: QuestionType.FILL_IN_BLANK, questionText: "Choose the letter(s) to make a correct word: pencil c__se", options: ["a", "e", "i", "o"], correctAnswer: "a", explanation: "Pencil case: Hộp bút." },
            { id: 171, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Look", "at", "the", "board."], correctAnswer: "Look at the board.", explanation: "Nhìn lên bảng." },
            { id: 172, type: QuestionType.FILL_IN_BLANK, questionText: "A: Who’s that boy? - B: _ _ ’s Peter.", correctAnswer: "He", explanation: "He is Peter." },
            { id: 173, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["The window", "is", "new,", "too."], correctAnswer: "The window is new, too.", explanation: "Cửa sổ cũng mới." },
            { id: 174, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the incorrect word(s) in the following sentence: Do you like hide seek?", options: ["Do", "you", "like", "hide seek"], correctAnswer: "hide seek", explanation: "Sai: phải là 'hide and seek'." },
            { id: 175, type: QuestionType.FILL_IN_BLANK, questionText: "Unscramble this word: ’’HOLOCS’’ -> ’’SCHO_ _ ’’.", correctAnswer: "OL", explanation: "SCHOOL: Trường học." },
            { id: 176, type: QuestionType.MULTIPLE_CHOICE, questionText: "Is this ___ bike? - No, it isn't.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi%20Th%E1%BB%AD/Thi_trai_nghiem_2021/Lop3/tracnghiem/tn-62.mp3"), options: ["his", "your", "my", "her"], correctAnswer: "your", explanation: "Nghe audio: Your bike." },
            { id: 177, type: QuestionType.MULTIPLE_CHOICE, questionText: "My bag is ______.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/1-tn-64.jpg"), options: ["blue", "gray", "black", "yellow"], correctAnswer: "blue", explanation: "Nhìn tranh: Màu xanh dương (blue)." },
            { id: 178, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the sentence that you hear:", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2019/11/29/637106243647920057_Audio.mp3"), options: ["I’m fine.", "I’m fine, thanks.", "Fine, thank you.", "I am fine, thank you."], correctAnswer: "Fine, thank you.", explanation: "Nghe audio." },
            { id: 179, type: QuestionType.FILL_IN_BLANK, questionText: "How are y_ _ ?", correctAnswer: "ou", explanation: "How are you?" },
            { id: 180, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["This", "is", "my", "pet."], correctAnswer: "This is my pet.", explanation: "Đây là thú cưng của tôi." },
            { id: 181, type: QuestionType.FILL_IN_BLANK, questionText: "Sally has bl_ _ eyes and blonde hair.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/1/636174948921681281_566X320.jpg"), correctAnswer: "ue", explanation: "Blue eyes: Mắt xanh." },
            { id: 182, type: QuestionType.MULTIPLE_CHOICE, questionText: "Odd one out:", options: ["meet", "I", "you", "he"], correctAnswer: "meet", explanation: "'Meet' là động từ, còn lại là đại từ." },
            { id: 183, type: QuestionType.FILL_IN_BLANK, questionText: "It's a brow_ teddy bear.", correctAnswer: "n", explanation: "Brown: Màu nâu." },
            { id: 184, type: QuestionType.FILL_IN_BLANK, questionText: "Horses and sheep live on the _ _ _ _ .", correctAnswer: "farm", explanation: "Farm: Nông trại." },
            { id: 185, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Let’s", "read", "the", "book."], correctAnswer: "Let’s read the book.", explanation: "Hãy đọc sách nào." },
            { id: 186, type: QuestionType.FILL_IN_BLANK, questionText: "Tha_ is my doll.", correctAnswer: "t", explanation: "That: Kia/Đó." },
            { id: 187, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Stand up", "and", "open", "your book."], correctAnswer: "Stand up and open your book.", explanation: "Đứng dậy và mở sách ra." },
            { id: 188, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["My school", "isn’t big", "but", "very tidy."], correctAnswer: "My school isn’t big but very tidy.", explanation: "Trường tôi không lớn nhưng rất gọn gàng." },
            { id: 189, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["I", "want to", "travel", "around", "the world."], correctAnswer: "I want to travel around the world.", explanation: "Tôi muốn đi du lịch vòng quanh thế giới." },
            { id: 190, type: QuestionType.FILL_IN_BLANK, questionText: "It _ _ a pencil.", correctAnswer: "is", explanation: "It is." },
            { id: 191, type: QuestionType.FILL_IN_BLANK, questionText: "List_ _ carefully.", correctAnswer: "en", explanation: "Listen: Nghe." },
            { id: 192, type: QuestionType.FILL_IN_BLANK, questionText: "SCHOOL-B_ G", correctAnswer: "A", explanation: "SCHOOL-BAG: Cặp sách." },
            { id: 193, type: QuestionType.MULTIPLE_CHOICE, questionText: "This is my ... .", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206312195910030_Audio.mp3"), options: ["class", "school", "room", "desk"], correctAnswer: "school", explanation: "Nghe audio: Trường học." },
            { id: 194, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["I am", "a pupil", "at", "Quang Trung Primary School."], correctAnswer: "I am a pupil at Quang Trung Primary School.", explanation: "Tôi là học sinh trường tiểu học Quang Trung." },
            { id: 195, type: QuestionType.MULTIPLE_CHOICE, questionText: "What does he do during ... lessons? - He learns about numbers.", options: ["Maths", "English", "Arts", "Music"], correctAnswer: "Maths", explanation: "Numbers (số) -> Maths (Toán)." },
            { id: 196, type: QuestionType.FILL_IN_BLANK, questionText: "We write \"06:20\" and we say \"It’s twenty _ _ _ _ six\".", correctAnswer: "past", explanation: "20 past 6 (6 giờ 20)." },
            { id: 197, type: QuestionType.MULTIPLE_CHOICE, questionText: "What colour is ______?", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Audio/3-tn-59.mp3"), options: ["they", "that", "it", "these"], correctAnswer: "it", explanation: "Nghe audio: Số ít (is) -> it." },
            { id: 198, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ OWN SHOES", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop3/Captruong/Images/3-dt-15.jpg"), correctAnswer: "BR", explanation: "BROWN: Màu nâu." },
            { id: 199, type: QuestionType.FILL_IN_BLANK, questionText: "That is my fa_ _ er.", correctAnswer: "th", explanation: "Father: Bố." },
            { id: 200, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["It's", "a", "nice", "puppy."], correctAnswer: "It's a nice puppy.", explanation: "Đó là một chú cún dễ thương." }
        ];

        // --- 3. HELPER UTILS ---
        function cn(...classes) {
            return classes.filter(Boolean).join(' ');
        }

        // --- 4. COMPONENTS ---

        const Button = ({ variant = 'primary', size = 'md', className, children, ...props }) => {
            const baseStyles = "inline-flex items-center justify-center font-bold transition-all duration-200 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transform active:scale-95";
            const variants = {
                primary: "bg-blue-600 hover:bg-blue-700 text-white shadow-blue-500/30 focus:ring-blue-500 border border-transparent",
                secondary: "bg-emerald-500 hover:bg-emerald-600 text-white shadow-emerald-500/30 focus:ring-emerald-500 border border-transparent",
                danger: "bg-rose-500 hover:bg-rose-600 text-white shadow-rose-500/30 focus:ring-rose-500 border border-transparent",
                outline: "bg-white border-2 border-slate-300 text-slate-600 hover:border-blue-500 hover:text-blue-600 shadow-slate-200/50"
            };
            const sizes = {
                sm: "px-4 py-1.5 text-sm",
                md: "px-6 py-3 text-base",
                lg: "px-8 py-4 text-lg"
            };
            return (
                <button className={cn(baseStyles, variants[variant], sizes[size], className)} {...props}>
                    {children}
                </button>
            );
        };

        const AudioPlayer = ({ src }) => {
            const audioRef = useRef(null);
            const [isPlaying, setIsPlaying] = useState(false);

            const togglePlay = () => {
                if (audioRef.current) {
                    if (isPlaying) audioRef.current.pause();
                    else audioRef.current.play();
                    setIsPlaying(!isPlaying);
                }
            };

            return (
                <div className="flex items-center gap-4 bg-white p-4 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow w-full max-w-md">
                    <button type="button" onClick={togglePlay} className="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors shadow-blue-200">
                        {isPlaying ? <Icons.Pause className="w-5 h-5" /> : <Icons.Play className="w-5 h-5 ml-1" />}
                    </button>
                    <div className="flex flex-col">
                        <span className="text-xs font-bold text-blue-600 uppercase tracking-wider mb-0.5">Câu hỏi Audio</span>
                        <span className="text-sm text-slate-500 flex items-center gap-1"><Icons.Volume2 className="w-4 h-4" /> Nhấn để nghe</span>
                    </div>
                    <audio ref={audioRef} src={src} onEnded={() => setIsPlaying(false)} className="hidden" />
                </div>
            );
        };

        const StartScreen = ({ onStart }) => {
            const [name, setName] = useState('');
            const handleSubmit = (e) => { e.preventDefault(); if (name.trim()) onStart(name.trim()); };
            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-cyan-500 to-blue-600 p-4">
                    <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 max-w-md w-full text-center transform transition-all duration-500 hover:scale-105">
                        <div className="mb-8 flex flex-col items-center">
                            <div className="w-20 h-20 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-6">
                                <Icons.GraduationCap className="w-10 h-10" />
                            </div>
                            <h1 className="text-3xl font-extrabold text-slate-800 mb-2">IOE K3 - Đề số 2</h1>
                            <p className="text-slate-500">Luyện thi tiếng Anh IOE cùng AI Master</p>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="text-left space-y-2">
                                <label className="block text-sm font-bold text-slate-700 ml-1">Họ và tên</label>
                                <input type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder="Nhập tên của bạn..." className="w-full px-6 py-4 rounded-xl border-2 border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/20 outline-none transition-all text-lg font-medium placeholder:text-slate-300" required />
                            </div>
                            <Button type="submit" className="w-full shadow-xl shadow-blue-500/40" size="lg" disabled={!name.trim()}>Bắt đầu làm bài</Button>
                        </form>
                    </div>
                </div>
            );
        };

        const ResultScreen = ({ userName, userAnswers, onRetryAll, onRetryWrong, onReviewWrong }) => {
            const correct = userAnswers.filter(a => a.isCorrect).length;
            const total = userAnswers.length;
            const incorrect = total - correct;
            const percentage = total === 0 ? 0 : Math.round((correct / total) * 100);

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-slate-50 animate-fade-in">
                    <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 max-w-2xl w-full text-center border border-slate-100">
                        <div className="inline-flex items-center justify-center w-24 h-24 bg-yellow-100 rounded-full mb-8 text-yellow-500 ring-8 ring-yellow-50">
                            <Icons.Trophy className="w-12 h-12" />
                        </div>
                        <h2 className="text-3xl md:text-4xl font-extrabold text-slate-800 mb-2">Hoàn thành bài thi!</h2>
                        <p className="text-lg text-slate-600 mb-8">Làm tốt lắm, <span className="font-bold text-blue-600">{userName}</span></p>
                        <div className="relative mb-10 inline-block">
                            <div className="text-7xl font-black text-blue-600 tracking-tight">{percentage}%</div>
                            <div className="text-sm font-bold text-slate-400 uppercase tracking-widest mt-1">Độ chính xác</div>
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-10">
                            <div className="bg-green-50 p-6 rounded-2xl border border-green-100">
                                <div className="flex items-center justify-center gap-2 mb-1"><Icons.CheckCircle className="w-5 h-5 text-green-500" /><span className="text-green-700 font-bold text-lg">Đúng</span></div>
                                <div className="text-3xl font-black text-green-600">{correct}</div>
                            </div>
                            <div className="bg-red-50 p-6 rounded-2xl border border-red-100">
                                <div className="flex items-center justify-center gap-2 mb-1"><Icons.XCircle className="w-5 h-5 text-red-500" /><span className="text-red-700 font-bold text-lg">Sai</span></div>
                                <div className="text-3xl font-black text-red-600">{incorrect}</div>
                            </div>
                        </div>
                        <div className="flex flex-col sm:flex-row justify-center gap-4">
                            <Button onClick={onRetryAll} size="md" variant="primary" className="shadow-lg shadow-blue-500/20"><Icons.RefreshCw className="w-5 h-5 mr-2" /> Chơi lại từ đầu</Button>
                            {incorrect > 0 && (
                                <>
                                    <Button onClick={onRetryWrong} size="md" variant="secondary" className="shadow-lg shadow-emerald-500/20"><Icons.RotateCcw className="w-5 h-5 mr-2" /> Làm lại câu sai</Button>
                                    <Button onClick={onReviewWrong} size="md" variant="outline" className="shadow-lg shadow-slate-200/50"><Icons.Eye className="w-5 h-5 mr-2" /> Xem lại câu sai</Button>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const QuestionCard = ({ question, onAnswer, isAnswered, userAnswer, isReviewMode }) => {
            const [inputVal, setInputVal] = useState('');
            const [selectedParts, setSelectedParts] = useState([]);
            const [showHint, setShowHint] = useState(false);

            useEffect(() => { setInputVal(''); setSelectedParts([]); setShowHint(false); }, [question.id]);

            const normalize = (str) => str ? str.replace(/[.,!?;:'"]/g, '').replace(/\s+/g, ' ').trim().toLowerCase() : "";
            const isCorrect = () => userAnswer && normalize(userAnswer) === normalize(question.correctAnswer);

            const handleMCSelect = (opt) => !isAnswered && onAnswer(opt);
            const handleInputSubmit = (e) => { e.preventDefault(); if (!isAnswered && inputVal.trim()) onAnswer(inputVal.trim()); };
            const handlePartClick = (part) => { if (!isAnswered) setSelectedParts(prev => prev.includes(part) ? prev.filter(p => p !== part) : [...prev, part]); };
            const handleRearrangeSubmit = () => !isAnswered && selectedParts.length > 0 && onAnswer(selectedParts.join(' '));

            const getQuestionTypeLabel = (type) => {
                switch (type) {
                    case QuestionType.MULTIPLE_CHOICE: return 'Trắc nghiệm';
                    case QuestionType.FILL_IN_BLANK: return 'Điền từ';
                    case QuestionType.REARRANGE: return 'Sắp xếp câu';
                    default: return type;
                }
            };

            return (
                <div className="w-full max-w-4xl mx-auto mb-8 animate-fade-in">
                    <div className="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100 ring-1 ring-slate-100">
                        <div className="bg-slate-50/80 backdrop-blur px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                            <span className="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-extrabold uppercase tracking-wide"><Icons.HelpCircle className="w-3 h-3 mr-1" />{getQuestionTypeLabel(question.type)}</span>
                            <span className="text-xs font-bold text-slate-400">ID: {question.id}</span>
                        </div>
                        <div className="p-6 sm:p-10">
                            <div className="mb-6 space-y-6">
                                {question.imageUrl && <div className="flex justify-center bg-slate-50 rounded-2xl p-4 border border-slate-100"><img src={question.imageUrl} className="max-h-72 rounded-lg shadow-sm object-contain" onError={(e) => e.target.style.display = 'none'} /></div>}
                                {question.audioUrl && <div className="flex justify-center"><AudioPlayer src={question.audioUrl} /></div>}
                            </div>
                            <div className="mb-8">
                                <div className="flex justify-between items-start gap-4">
                                    <h2 className="text-xl sm:text-2xl font-bold text-slate-800 leading-relaxed">{question.questionText}</h2>
                                    {!isAnswered && (
                                        <button onClick={() => setShowHint(!showHint)} className={`shrink-0 flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold transition-all shadow-sm ${showHint ? 'bg-yellow-100 text-yellow-700 ring-2 ring-yellow-400 ring-offset-1' : 'bg-white border border-slate-200 text-slate-500 hover:text-yellow-600 hover:border-yellow-300'}`}>
                                            <Icons.Lightbulb className={`w-4 h-4 ${showHint ? 'fill-yellow-500' : ''}`} /><span className="hidden sm:inline">{showHint ? 'Ẩn gợi ý' : 'Gợi ý'}</span>
                                        </button>
                                    )}
                                </div>
                                {showHint && !isAnswered && (
                                    <div className="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-xl text-slate-700 animate-fade-in relative overflow-hidden shadow-sm">
                                        <div className="absolute top-0 left-0 w-1 h-full bg-yellow-400"></div>
                                        <div className="flex gap-3"><div className="shrink-0 p-2 bg-yellow-100 rounded-lg text-yellow-600 h-fit"><Icons.Lightbulb className="w-5 h-5" /></div><div><p className="font-bold text-yellow-800 text-sm uppercase tracking-wide mb-1">Gợi ý:</p><p className="text-slate-800 leading-relaxed font-medium">{question.explanation}</p></div></div>
                                    </div>
                                )}
                            </div>
                            {question.type === QuestionType.MULTIPLE_CHOICE && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {question.options?.map((opt, idx) => {
                                        let buttonStyle = "bg-white hover:border-blue-400 border-slate-200 text-slate-700";
                                        if (isAnswered) {
                                            if (opt === question.correctAnswer) buttonStyle = "bg-green-100 border-green-500 text-green-800 ring-1 ring-green-500";
                                            else if (opt === userAnswer) buttonStyle = "bg-red-100 border-red-500 text-red-800 ring-1 ring-red-500";
                                            else buttonStyle = "bg-slate-50 border-slate-200 text-slate-400 opacity-50";
                                        }
                                        return <button key={idx} onClick={() => handleMCSelect(opt)} disabled={isAnswered} className={`w-full p-4 rounded-xl text-left border-2 transition-all duration-200 font-medium flex items-center ${buttonStyle}`}><span className="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-500 font-bold mr-3 text-sm shrink-0">{String.fromCharCode(65 + idx)}</span>{opt}</button>;
                                    })}
                                </div>
                            )}
                            {question.type === QuestionType.FILL_IN_BLANK && (
                                <form onSubmit={handleInputSubmit} className="flex flex-col sm:flex-row gap-4">
                                    <input type="text" value={isAnswered && userAnswer ? userAnswer : inputVal} onChange={(e) => setInputVal(e.target.value)} disabled={isAnswered} className={`flex-1 p-4 rounded-xl border-2 outline-none transition-all font-medium text-lg ${isAnswered ? (isCorrect() ? 'border-green-500 bg-green-50 text-green-900' : 'border-red-500 bg-red-50 text-red-900') : 'border-slate-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100'}`} placeholder="Nhập câu trả lời..." />
                                    {!isAnswered && <Button type="submit" className="whitespace-nowrap">Trả lời</Button>}
                                </form>
                            )}
                            {question.type === QuestionType.REARRANGE && (
                                <div className="space-y-8">
                                    <div className="flex flex-wrap gap-3 justify-center">
                                        {question.rearrangeParts?.map((part, idx) => (
                                            <button key={idx} onClick={() => handlePartClick(part)} disabled={isAnswered || selectedParts.includes(part)} className={`px-4 py-2 rounded-lg font-semibold border-b-4 transition-all active:border-b-0 active:translate-y-1 ${selectedParts.includes(part) ? 'opacity-30 bg-slate-100 border-slate-200 cursor-not-allowed' : 'bg-white border-slate-200 shadow-sm hover:border-blue-400 hover:text-blue-600 text-slate-600'}`}>{part}</button>
                                        ))}
                                    </div>
                                    <div className={`min-h-[80px] p-6 rounded-xl border-2 border-dashed flex flex-wrap gap-2 items-center justify-center transition-colors ${isAnswered ? (isCorrect() ? 'border-green-500 bg-green-50/50' : 'border-red-500 bg-red-50/50') : 'border-slate-300 bg-slate-50'}`}>
                                        {selectedParts.length === 0 && !isAnswered && <span className="text-slate-400 text-sm font-medium">Nhấn vào các từ bên trên để sắp xếp</span>}
                                        {selectedParts.map((part, idx) => <button key={idx} onClick={() => handlePartClick(part)} disabled={isAnswered} className="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium shadow-sm hover:bg-red-500 transition-colors">{part}</button>)}
                                    </div>
                                    {!isAnswered && <div className="flex justify-end"><Button onClick={handleRearrangeSubmit} disabled={selectedParts.length === 0}>Xác nhận</Button></div>}
                                </div>
                            )}
                            {isAnswered && (
                                <div className={`mt-10 p-6 rounded-2xl border animate-slide-up ${isCorrect() ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>
                                    <div className="flex items-start gap-4">
                                        <div className={`p-2 rounded-full shrink-0 ${isCorrect() ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}>{isCorrect() ? <Icons.CheckCircle2 className="w-6 h-6" /> : <Icons.XCircle className="w-6 h-6" />}</div>
                                        <div className="flex-1">
                                            <h3 className={`font-bold text-lg mb-1 ${isCorrect() ? 'text-green-800' : 'text-red-800'}`}>{isCorrect() ? 'Chính xác!' : 'Chưa chính xác'}</h3>
                                            {!isCorrect() && <div className="mb-3 text-red-700">Đáp án đúng: <span className="font-bold bg-white px-2 py-0.5 rounded border border-red-200 ml-1">{question.correctAnswer}</span></div>}
                                            <div className="text-slate-700 bg-white/80 p-4 rounded-xl border border-slate-200/50 mt-3 shadow-sm">
                                                <div className="flex items-center gap-2 mb-2 text-blue-600 border-b border-blue-100 pb-2"><Icons.Lightbulb className="w-4 h-4" /><span className="font-bold text-sm uppercase tracking-wider">Giải thích chi tiết</span></div>
                                                {question.explanation}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [gameState, setGameState] = useState(GameState.START);
            const [userName, setUserName] = useState('');
            const [activeQuestions, setActiveQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [userAnswers, setUserAnswers] = useState([]);
            const [showQuestionGrid, setShowQuestionGrid] = useState(false);
            const [isReviewMode, setIsReviewMode] = useState(false);

            const handleStart = (name) => { setUserName(name); startNewGame(QUIZ_DATA); };
            const startNewGame = (questions) => { setActiveQuestions(questions); setCurrentIndex(0); setUserAnswers([]); setIsReviewMode(false); setGameState(GameState.PLAYING); setShowQuestionGrid(false); };
            const handleAnswer = (response) => {
                const q = activeQuestions[currentIndex];
                const normalize = (s) => s.replace(/[.,!?;:'"]/g, '').replace(/\s+/g, ' ').trim().toLowerCase();
                const isCorrect = normalize(response) === normalize(q.correctAnswer);
                setUserAnswers(prev => [...prev.filter(a => a.questionId !== q.id), { questionId: q.id, userResponse: response, isCorrect }]);
            };
            const handleNext = () => { if (currentIndex < activeQuestions.length - 1) { setCurrentIndex(prev => prev + 1); window.scrollTo({ top: 0, behavior: 'smooth' }); } };
            const handlePrev = () => { if (currentIndex > 0) { setCurrentIndex(prev => prev - 1); window.scrollTo({ top: 0, behavior: 'smooth' }); } };
            const handleSkip = () => handleNext();
            const handleJumpToQuestion = (index) => { setCurrentIndex(index); setShowQuestionGrid(false); window.scrollTo({ top: 0, behavior: 'smooth' }); };
            const handleFinish = () => {
                const unansweredCount = activeQuestions.length - userAnswers.length;
                if (unansweredCount > 0) { if (!confirm(`Bạn còn ${unansweredCount} câu chưa hoàn thành. Bạn có chắc chắn muốn nộp bài không?`)) return; }
                setGameState(GameState.FINISHED); window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            const handleRetryAll = () => startNewGame(QUIZ_DATA);
            const handleRetryWrong = () => {
                const wrongIds = userAnswers.filter(a => !a.isCorrect).map(a => a.questionId);
                const wrongQuestions = QUIZ_DATA.filter(q => wrongIds.includes(q.id));
                if (wrongQuestions.length > 0) startNewGame(wrongQuestions);
            };
            const handleReviewWrong = () => {
                const wrongIds = userAnswers.filter(a => !a.isCorrect).map(a => a.questionId);
                const wrongQuestions = QUIZ_DATA.filter(q => wrongIds.includes(q.id));
                if (wrongQuestions.length > 0) { setActiveQuestions(wrongQuestions); setCurrentIndex(0); setIsReviewMode(true); setGameState(GameState.PLAYING); setShowQuestionGrid(false); }
            };

            if (gameState === GameState.START) return <StartScreen onStart={handleStart} />;
            if (gameState === GameState.FINISHED) return <ResultScreen userName={userName} userAnswers={userAnswers} onRetryAll={handleRetryAll} onRetryWrong={handleRetryWrong} onReviewWrong={handleReviewWrong} />;

            const currentQ = activeQuestions[currentIndex];
            const answer = userAnswers.find(a => a.questionId === currentQ.id);
            const isAnswered = !!answer;
            const isLast = currentIndex === activeQuestions.length - 1;
            const getQuestionStatus = (qId) => {
                if (currentQ.id === qId) return 'current';
                const ans = userAnswers.find(a => a.questionId === qId);
                if (ans) return ans.isCorrect ? 'correct' : 'incorrect';
                return 'unanswered';
            };

            return (
                <div className="min-h-screen bg-slate-100 flex flex-col items-center py-8 px-4 pb-32">
                    <div className="w-full max-w-4xl flex justify-between items-center mb-8 bg-white px-4 sm:px-6 py-4 rounded-2xl shadow-sm border border-slate-200 sticky top-4 z-20">
                        <div className="flex items-center gap-3"><div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center font-bold text-blue-600 shrink-0">{userName.charAt(0).toUpperCase()}</div><div className="hidden sm:block font-bold text-slate-700 truncate max-w-[150px]">{userName}</div></div>
                        <div className="flex items-center gap-2 sm:gap-4">
                            {isReviewMode && <span className="bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs font-bold uppercase">Chế độ xem lại</span>}
                            <button onClick={() => setShowQuestionGrid(true)} className="flex items-center gap-2 bg-slate-100 hover:bg-slate-200 px-3 py-2 rounded-lg transition-colors text-slate-700 font-bold text-sm"><Icons.LayoutGrid className="w-4 h-4" /><span className="hidden sm:inline">Danh sách câu hỏi</span><span className="inline sm:hidden">{currentIndex + 1}/{activeQuestions.length}</span></button>
                            <div className="hidden sm:flex items-center gap-2 bg-slate-100 px-4 py-2 rounded-lg"><span className="text-slate-500 text-sm font-bold uppercase tracking-wider">Câu</span><span className="font-black text-blue-600 text-lg">{currentIndex + 1}</span><span className="text-slate-400">/</span><span className="font-bold text-slate-500">{activeQuestions.length}</span></div>
                        </div>
                    </div>
                    <QuestionCard question={currentQ} onAnswer={handleAnswer} isAnswered={isAnswered || isReviewMode} userAnswer={answer?.userResponse} isReviewMode={isReviewMode} />
                    {showQuestionGrid && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
                            <div className="bg-white rounded-2xl w-full max-w-2xl max-h-[80vh] flex flex-col shadow-2xl">
                                <div className="p-4 border-b flex justify-between items-center"><h3 className="font-bold text-lg text-slate-800">Danh sách câu hỏi</h3><button onClick={() => setShowQuestionGrid(false)} className="p-2 hover:bg-slate-100 rounded-full"><Icons.X className="w-5 h-5" /></button></div>
                                <div className="p-4 overflow-y-auto grid grid-cols-5 sm:grid-cols-8 gap-2">
                                    {activeQuestions.map((q, idx) => {
                                        const status = getQuestionStatus(q.id);
                                        let bgClass = "bg-slate-100 text-slate-600 hover:bg-slate-200 border-slate-200";
                                        if (status === 'current') bgClass = "bg-blue-600 text-white border-blue-600 ring-2 ring-blue-300";
                                        else if (status === 'correct') bgClass = "bg-green-100 text-green-700 border-green-300";
                                        else if (status === 'incorrect') bgClass = "bg-red-100 text-red-700 border-red-300";
                                        else if (status === 'unanswered') bgClass = "bg-white text-slate-700 border-slate-300 border-dashed";
                                        return <button key={q.id} onClick={() => handleJumpToQuestion(idx)} className={`h-10 rounded-lg font-bold text-sm border ${bgClass} transition-all`}>{idx + 1}</button>;
                                    })}
                                </div>
                                <div className="p-4 border-t bg-slate-50 rounded-b-2xl text-xs flex gap-4 text-slate-600 font-medium">
                                    <div className="flex items-center gap-1"><div className="w-3 h-3 bg-green-100 border border-green-300 rounded"></div> Đúng</div>
                                    <div className="flex items-center gap-1"><div className="w-3 h-3 bg-red-100 border border-red-300 rounded"></div> Sai</div>
                                    <div className="flex items-center gap-1"><div className="w-3 h-3 bg-white border border-slate-300 border-dashed rounded"></div> Chưa làm</div>
                                </div>
                            </div>
                        </div>
                    )}
                    <div className="fixed bottom-0 left-0 right-0 p-4 bg-white/90 backdrop-blur-md border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-20">
                        <div className="w-full max-w-4xl mx-auto flex justify-between gap-3">
                            <Button onClick={handlePrev} variant="outline" disabled={currentIndex === 0} className="flex items-center px-4"><Icons.ArrowLeft className="w-4 h-4 sm:mr-2" /> <span className="hidden sm:inline">Trước</span></Button>
                            <div className="flex gap-3">
                                {isAnswered || isReviewMode ? (!isLast ? <Button onClick={handleNext} className="flex items-center shadow-blue-500/30">Câu tiếp theo <Icons.ArrowRight className="w-4 h-4 ml-2" /></Button> : <Button onClick={handleFinish} variant="secondary" className="flex items-center shadow-emerald-500/30">{isReviewMode ? 'Kết thúc xem lại' : 'Nộp bài'} <Icons.CheckSquare className="w-4 h-4 ml-2" /></Button>) : <Button variant="outline" onClick={handleSkip} className="text-slate-500 hover:text-slate-700 border-dashed hover:border-slate-400">Bỏ qua <Icons.Flag className="w-4 h-4 ml-2" /></Button>}
                            </div>
                            {isAnswered && !isLast && <div className="hidden sm:block w-[1px]"></div>}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>